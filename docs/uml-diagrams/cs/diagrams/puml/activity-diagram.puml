@startuml BeCoMe-Activity-Diagram

' Style configuration
skinparam backgroundColor #FFFFFF
skinparam shadowing false
skinparam defaultFontSize 12
skinparam activityBorderColor #333333
skinparam activityBackgroundColor #F0F0F0

start

:Přijmout seznam názorů expertů;
note right
    Vstup: List[ExpertOpinion]
    Každý názor obsahuje:
    - expert_id
    - FuzzyTriangleNumber(lower, peak, upper)
end note

' Validation
if (je seznam názorů prázdný?) then (ano)
    :Vyvolat ValueError;
    stop
else (ne)
    :M = počet expertů;
endif

' === STEP 1: Arithmetic Mean ===
partition "**Krok 1: Vypočítat aritmetický průměr (Γ)**" #FFDDDD {
    :Inicializovat součty:\n- sum_lower = 0\n- sum_peak = 0\n- sum_upper = 0;

    repeat :Pro každý názor v opinions;
        :sum_lower += opinion.lower_bound;
        :sum_peak += opinion.peak;
        :sum_upper += opinion.upper_bound;
    repeat while (další názory?) is (ano)
    ->ne;

    :Vypočítat průměry:\n- α = sum_lower / M\n- γ = sum_peak / M\n- β = sum_upper / M;

    :Vytvořit Gamma (Γ):\nFuzzyTriangleNumber(α, γ, β);
}

' === STEP 2: Median ===
partition "**Krok 2: Vypočítat medián (Ω)**" #DDFFDD {
    ' Sort by centroid
    :Vypočítat těžiště pro každý názor:\nGx = (lower + peak + upper) / 3;

    :Seřadit názory podle těžiště\n(vzestupně);

    :Vypočítat medián těžišť:\nmedian_centroid = statistics.median(centroids);

    ' Check if odd or even
    if (M je lichý?\nM = 2n + 1) then (ano)
        :Najít názor s těžištěm\nnejbližším k median_centroid;

        :Extrahovat komponenty:\n- ρ = opinion.lower_bound\n- ω = opinion.peak\n- σ = opinion.upper_bound;

    else (ne, M je sudý\nM = 2n)
        :Najít dva názory s těžišti\nnejbližšími k median_centroid;

        :Zprůměrovat dva názory:\n- ρ = (left.lower + right.lower) / 2\n- ω = (left.peak + right.peak) / 2\n- σ = (left.upper + right.upper) / 2;
    endif

    :Vytvořit Omega (Ω):\nFuzzyTriangleNumber(ρ, ω, σ);
}

' === STEP 3: Best Compromise ===
partition "**Krok 3: Vypočítat nejlepší kompromis (ΓΩMean)**" #DDDDFF {
    :Vypočítat kompromis:\n- π = (α + ρ) / 2\n- φ = (γ + ω) / 2\n- ξ = (β + σ) / 2;

    :Vytvořit ΓΩMean:\nFuzzyTriangleNumber(π, φ, ξ);
}

' === STEP 4: Maximum Error ===
partition "**Krok 4: Vypočítat maximální chybu (Δmax)**" #FFFFDD {
    :Vypočítat těžiště:\n- mean_centroid = Γ.get_centroid()\n- omega_centroid = Ω.get_centroid();

    :Vypočítat max. chybu:\nΔmax = |mean_centroid - omega_centroid| / 2;

    note right
        Δmax je ukazatel přesnosti.
        Menší hodnoty indikují
        vyšší shodu mezi experty.
    end note
}

' === STEP 5: Create Result ===
:Vytvořit BeCoMeResult:\n- best_compromise = ΓΩMean\n- arithmetic_mean = Γ\n- median = Ω\n- max_error = Δmax\n- num_experts = M\n- is_even = (M % 2 == 0);

:Vrátit BeCoMeResult;

stop

@enduml
